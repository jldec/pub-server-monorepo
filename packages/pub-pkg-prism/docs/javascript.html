<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="robots" content="noindex, nofollow">

<!-- html generated by pub-server from markdown /javascript.md -->

<title>JavaScript</title>
<link rel="stylesheet" href="./css/prism.css">
<link rel="stylesheet" href="./css/github-markdown.css">
<link rel="stylesheet" href="./css/pub-theme-doc.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout">
<header>
<div id="doctitle"><h1 id="pub-pkg-prism"><a href="./">pub-pkg-prism</a></h1>
</div>
<div id="topmenu"><ul>
<li><a href="https://github.com/jldec/pub-pkg-prism" title="github" target="_blank" rel="noopener"><span class="fa fa-lg fa-fw">&#xf09b;</span></a></li>
</ul>
</div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-lg">&#xf0c9;</span></p>

<nav id="toc">
<ul>
<li><a href="./">README</a></li>
<li><a href="./java">Java</a></li>
<li><a href="./javascript">JavaScript</a></li>
<li><a href="./markdown">Markdown</a></li>
<li><a href="./python">Python</a></li>
</ul>
</nav>
</div>

<div id="main" onclick="">
<div id="content" class="markdown-body">
<div data-render-page="/javascript">
<div data-render-html="/javascript"><h3 id="javascript">JavaScript</h3>
<pre><code class="language-js"><span class="token comment">/*
 * asyncbuilder
 * simple semi-asynchronous list builder
 * Copyright (c) 2015-2022 Jürgen Leschner - github.com/jldec - MIT license
*/</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> asyncbuilder<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">asyncbuilder</span><span class="token punctuation">(</span><span class="token parameter">mainCallBack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">asyncbuilder</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">asyncbuilder</span><span class="token punctuation">(</span>mainCallBack<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// private</span>
  <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pending <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// number of outstanding results</span>
  <span class="token keyword">var</span> isComplete <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// true after complete()</span>
  <span class="token keyword">var</span> spent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token comment">// true after mainCallBack()</span>
  <span class="token keyword">var</span> asyncErr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// queued async err</span>

  <span class="token comment">// public</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>append <span class="token operator">=</span> append<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>asyncAppend <span class="token operator">=</span> asyncAppend<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>complete <span class="token operator">=</span> complete<span class="token punctuation">;</span>

  <span class="token comment">//--//--//--//--//--//--//--//--//--//</span>

  <span class="token comment">// append result immediately (no callback required)</span>
  <span class="token keyword">function</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>spent<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'asyncbuilder append after mainCallBack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      asyncErr <span class="token operator">=</span> asyncErr <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'asyncbuilder append after complete.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// reserve a slot and return a callback(err, result) for async result</span>
  <span class="token comment">// the callback inserts the result into the slot (or propagetes any error)</span>
  <span class="token keyword">function</span> <span class="token function">asyncAppend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>spent<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'asyncbuilder asyncAppend after mainCallBack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      asyncErr <span class="token operator">=</span> asyncErr <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'asyncbuilder asyncAppend after complete.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> slot <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    pending<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pending<span class="token operator">--</span><span class="token punctuation">;</span>
      asyncErr <span class="token operator">=</span> asyncErr <span class="token operator">||</span> err<span class="token punctuation">;</span>
      results<span class="token punctuation">[</span>slot<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isComplete <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>spent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">mainCallBack</span><span class="token punctuation">(</span>asyncErr<span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// call ab.complete() after the last append() or asyncAppend()</span>
  <span class="token keyword">function</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isComplete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>spent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mainCallBack</span><span class="token punctuation">(</span>asyncErr<span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
</div>

</div><!--page-->
</div>
<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-doc" target="_blank" rel="noopener">pub-theme-doc</a></p>
</div>
</div>

</div><!--layout-->

<script>window.pubRef = {"href":"/javascript","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- Copyright (c) 2015-2022 Jürgen Leschner - github.com/jldec - MIT license -->
</body>
</html>
